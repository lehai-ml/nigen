
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nimagen.visualisation &#8212; NIMAGEN 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for nimagen.visualisation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">visualisation.py</span>
<span class="sd">This is a visualisation file, containing all the necessary visualisations.</span>
<span class="sd">You can draw simple plots, Bar or Scatter, or the Brain segmentation</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">ttest_ind</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span> <span class="c1"># used to do visualise brain maps</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>  <span class="c1"># forward compatibility for Python 3</span>
<span class="kn">import</span> <span class="nn">operator</span>

<div class="viewcode-block" id="SimplePlots"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots">[docs]</a><span class="k">class</span> <span class="nc">SimplePlots</span><span class="p">:</span>
    
<div class="viewcode-block" id="SimplePlots.return_array"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.return_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">return_array</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">str</span><span class="p">,</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">data</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">must_be</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">variable_label</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience function to take in multiple data types and return numpy array</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Union[np.ndarray,pd.DataFrame,pd.Series,str,List[Union[str,float,</span>
<span class="sd">            int,pd.Series,np.ndarray]]], optional</span>
<span class="sd">            The variable of interest. The default is None.</span>
<span class="sd">        data : Optional[pd.DataFrame], optional</span>
<span class="sd">            The pd.DataFrame if providing column names as x. The default is None.</span>
<span class="sd">        must_be : Optional[str], optional</span>
<span class="sd">            {str,int,float}. np.ndarray.astype() will be applied The default is None.</span>
<span class="sd">        variable_label : Optional[str], optional</span>
<span class="sd">            DESCRIPTION. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x : np.ndarray</span>
<span class="sd">            The returned array.</span>
<span class="sd">        variable_label</span>
<span class="sd">            the name of the variable x.</span>
<span class="sd">        column_names</span>
<span class="sd">            the column of each column in x if x is multi-dimensional.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_label</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_label</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">variable_label</span> <span class="o">=</span> <span class="n">variable_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">variable_label</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_label</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                        <span class="n">variable_label</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">variable_label</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span> <span class="c1">#np.ndarray</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># if x.ndim &gt; 1</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span>
                
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">variable_label</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">variable_label</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="c1">#make sure x is all strings</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="n">x</span>            
                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="c1"># multiple columns arrays</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span> 
                <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;if providing list of arrays, arrays must be 1 dimensional&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">)):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">must_be</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">must_be</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span><span class="n">variable_label</span><span class="p">,</span><span class="n">column_names</span></div>
    
<div class="viewcode-block" id="SimplePlots.Groupby"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.Groupby">[docs]</a>    <span class="k">class</span> <span class="nc">Groupby</span><span class="p">:</span>
        
<div class="viewcode-block" id="SimplePlots.Groupby.groupby"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.Groupby.groupby">[docs]</a>        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Perform groupby operation based on several arguments to return a defaultdict dictionary</span>
<span class="sd">            It is recommended for the args to be discrete or categorical variables (because we are taking the unique values)</span>
<span class="sd">            Kwargs can be both categorical or continuous. But if it is for a bar plot, it should be continuous variables.</span>
<span class="sd">            This function is similar to using pd.DataFrame groupby, pd.set_index.</span>
<span class="sd">            You can have as many level of args or kwargs as you want.</span>
<span class="sd">            Usage example:</span>
<span class="sd">                x = [&#39;foo1&#39;, &#39;foo2&#39;, &#39;foo1&#39;, &#39;foo2&#39;]</span>
<span class="sd">                y = [-0.4, 0.3, 1.4, 1.3] </span>
<span class="sd">                color = [&#39;red&#39;, &#39;blue&#39;, &#39;red&#39;, &#39;red&#39;] </span>
<span class="sd">                gender = [2, 1, 1, 3]</span>
<span class="sd">            groupby(x,y=y): will group by x values. to produce</span>
<span class="sd">            {&#39;foo1&#39;:{&#39;y&#39;:[-0.4,1.4]},&#39;foo2&#39;:{&#39;y&#39;:[0.3,1.3]}}</span>
<span class="sd">            groupby(x,color,y=y) will group by x and color value to produce</span>
<span class="sd">            {&#39;foo1&#39;: {&#39;blue&#39;: defaultdict(list, {&#39;y&#39;: []}),</span>
<span class="sd">              &#39;red&#39;: defaultdict(list, {&#39;y&#39;: [-0.4, 1.4]})},</span>
<span class="sd">             &#39;foo2&#39;: {&#39;blue&#39;: defaultdict(list, {&#39;y&#39;: [0.3]}),</span>
<span class="sd">              &#39;red&#39;: defaultdict(list, {&#39;y&#39;: [1.3]})}}</span>
<span class="sd">            grouby(x,color,y=y,gender=gender) will groupby by x and color value to produce</span>
<span class="sd">            {&#39;foo1&#39;: {&#39;blue&#39;: defaultdict(list, {&#39;y&#39;: [], &#39;gender&#39;: []}),</span>
<span class="sd">              &#39;red&#39;: defaultdict(list, {&#39;y&#39;: [-0.4, 1.4], &#39;gender&#39;: [2, 1]})},</span>
<span class="sd">             &#39;foo2&#39;: {&#39;blue&#39;: defaultdict(list, {&#39;y&#39;: [0.3], &#39;gender&#39;: [1]}),</span>
<span class="sd">              &#39;red&#39;: defaultdict(list, {&#39;y&#39;: [1.3], &#39;gender&#39;: [3]})}})</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            *args : np.ndarray</span>
<span class="sd">                set of discrete or categorical variables</span>
<span class="sd">            **kwargs : np.ndarray</span>
<span class="sd">                the values to plot (e.g. on y-axis or to color the bar by)</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            temp_plot_dict : dict</span>
<span class="sd">                A nested dictionary, where the dictionary keys are made up of the *args,</span>
<span class="sd">                and the values in the deepest layer are the **kwargs</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># create a dictionary set that contains as keys all the possible combinations of arguments</span>
            <span class="k">def</span> <span class="nf">dictionary_merge</span><span class="p">(</span><span class="n">dict1</span><span class="p">,</span><span class="n">dict2</span><span class="p">):</span>
            <span class="c1">#convenience function to merge nested dictionary together</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="nb">dict</span><span class="p">):</span>
                            <span class="n">dictionary_merge</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">dict1</span>
            
            <span class="n">temp_plot_dict</span><span class="o">=</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
            <span class="n">all_unique_keys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
            <span class="n">all_possible_keys</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">all_unique_keys</span><span class="p">)</span>
            <span class="n">all_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">keys_combo</span> <span class="ow">in</span> <span class="n">all_possible_keys</span><span class="p">:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">all_values</span><span class="p">:</span>
                    <span class="n">temp_dict</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">keys_combo</span><span class="p">):</span>
                    <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">temp_dict</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">temp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">temp_plot_dict</span><span class="p">:</span>
                        <span class="n">temp_plot_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictionary_merge</span><span class="p">(</span><span class="n">temp_plot_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp_plot_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">len_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key_vals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">*</span><span class="n">kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">key_vals</span><span class="p">[:</span><span class="n">len_args</span><span class="p">]</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">key_vals</span><span class="p">[</span><span class="n">len_args</span><span class="p">:]</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">temp_plot_dict</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">key_idx</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">key_idx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">name_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_values</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">name_val</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                            <span class="n">obj</span><span class="p">[</span><span class="n">name_val</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    
            <span class="k">return</span> <span class="n">temp_plot_dict</span></div>

<div class="viewcode-block" id="SimplePlots.Groupby.groupby_operation"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.Groupby.groupby_operation">[docs]</a>        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">groupby_operation</span><span class="p">(</span><span class="n">groupby_dict</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span><span class="n">operation</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span><span class="nb">str</span><span class="p">])</span><span class="o">-&gt;</span><span class="nb">dict</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Perform groupby operation on the output of groupby function.</span>
<span class="sd">            Performs recursive opening of the nested dictionary to perform some</span>
<span class="sd">            operations on the last layer of the dictionary</span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            groupby_dict : dict</span>
<span class="sd">                Nested dictionary, output from groupby function</span>

<span class="sd">            operation : Union[dict,str]</span>
<span class="sd">                operation to be performed on the deepest layer of the nested dictionary</span>
<span class="sd">                IF str:{&#39;sum&#39;,&#39;mean&#39;,&#39;count&#39;,&#39;first&#39;,&#39;last&#39;,&#39;max&#39;,&#39;min&#39;}.</span>
<span class="sd">                This operation will be applied to all lists in the last layer irrespective of the name.</span>
<span class="sd">                IF dict, the key must be the key of the lists in the last layer.</span>
<span class="sd">                e.g. {&#39;y&#39;:&#39;sum&#39;,&#39;color&#39;:&#39;first&#39;}. This will find the key y</span>
<span class="sd">                in the last layer and perform sum but will find the key color and perform first.</span>
<span class="sd">                </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            dict</span>
<span class="sd">                Updated groupby_dict</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">def</span> <span class="nf">do_operation</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">operation</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;sum&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;count&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span><span class="s1">&#39;first&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span><span class="s1">&#39;last&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    
            <span class="k">def</span> <span class="nf">find_last_depth</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">operation</span><span class="p">):</span>
                <span class="c1">#convenience function to recursively perform some function on</span>
                <span class="c1"># the deepest layer of a nested function</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                        <span class="n">find_last_depth</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">operation</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">operation</span><span class="p">:</span>
                            <span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_operation</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">operation</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                            <span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_operation</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">operation</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">obj</span>
            
            <span class="k">return</span> <span class="n">find_last_depth</span><span class="p">(</span><span class="n">groupby_dict</span><span class="p">,</span><span class="n">operation</span><span class="p">)</span> </div></div>
    
<div class="viewcode-block" id="SimplePlots.sort_array"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.sort_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sort_array</span><span class="p">(</span><span class="n">current_array</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">specific_order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">specific_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">current_array</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ascending</span><span class="p">:</span>
                <span class="n">new_array</span> <span class="o">=</span> <span class="n">new_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_idx</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">values</span> <span class="ow">in</span> <span class="n">specific_order</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="n">new_idx</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_array</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">value</span><span class="p">])</span>
            <span class="n">new_array</span> <span class="o">=</span> <span class="n">current_array</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">new_idx</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">new_array</span></div>
    
<div class="viewcode-block" id="SimplePlots.get_color_pallete"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.get_color_pallete">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_color_pallete</span><span class="p">(</span><span class="n">colorby</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmap</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmap_reversed</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">#convenience function to get color pallete and scalar mapable</span>
        <span class="c1"># color will be consistent across multiple plots if seperateby is defined.</span>
        <span class="k">if</span> <span class="n">colorby</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
        <span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">colorby</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cmap_reversed</span><span class="p">:</span>
            <span class="n">pal</span> <span class="o">=</span> <span class="n">pal</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="n">colorby</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="n">my_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">pal</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">colorby</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">colorby</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">scalar_mappable</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">my_cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="n">scalar_mappable</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pal</span><span class="p">)[</span><span class="n">rank</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">color</span><span class="p">,</span><span class="n">scalar_mappable</span></div>
    
        
<div class="viewcode-block" id="SimplePlots.Bar"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.Bar">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">Bar</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span>
            <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
            <span class="n">y2</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">colorby</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">separateby</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">hue</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">order</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="nb">dict</span><span class="p">,</span><span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">groupby_operation</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">fig</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">figkwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create bar plot.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Union[np.ndarray,pd.DataFrame,pd.Series,list,str]</span>
<span class="sd">            X-axis. Must be categorical data</span>
<span class="sd">        y : Union[np.ndarray, pd.DataFrame, pd.Series,list, str]</span>
<span class="sd">            Y-axis. Must be continuous data</span>
<span class="sd">        colorby : Union[np.ndarray,pd.DataFrame,pd.Series,list,str], optional</span>
<span class="sd">            Continuous data that can be used to color each bar. The default is </span>
<span class="sd">            None.</span>
<span class="sd">        separateby : Union[np.ndarray,pd.DataFrame,pd.Series,list,str], optional</span>
<span class="sd">            Categorical data that can be used to separate different plots. The </span>
<span class="sd">            default is None.</span>
<span class="sd">        hue : Union[np.ndarray,pd.DataFrame,pd.Series,list,str], optional</span>
<span class="sd">            Categorical data that can be used to separate different bars in the</span>
<span class="sd">            same plot. The default is None.</span>
<span class="sd">            If both colorby and hue is defined, then colorby will be ignored.</span>
<span class="sd">        order: Union[list,dict,str]:</span>
<span class="sd">            Define the order of the bars.</span>
<span class="sd">            Default is &#39;y&#39;: This will oder the bar in the ascending order of y</span>
<span class="sd">            other option include [&#39;seperateby&#39;,&#39;x&#39;,&#39;hue&#39;,&#39;y&#39;,&#39;colorby&#39;] where </span>
<span class="sd">            separateby, x and hue can be ordered alphabetically, and y, colorby</span>
<span class="sd">            ordered numerically. Set order_reversed to True or False to ascending</span>
<span class="sd">            or descending.</span>
<span class="sd">            if specific order is required. Provide a dictionary</span>
<span class="sd">            e.g. {&#39;x&#39;:[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;]} and the bars will order by the list.</span>
<span class="sd">        data : Optional[pd.DataFrame], optional</span>
<span class="sd">            DataFrame from which to get the values from . The default is None.</span>
<span class="sd">        groupby_operation : Union[str,dict], optional</span>
<span class="sd">            perform function to &#39;y&#39; and &#39;colorby&#39;</span>
<span class="sd">            Possible operations include</span>
<span class="sd">            {sum,mean,max,min,first,last}</span>
<span class="sd">            if same groupby operation on y and colorby, use string.</span>
<span class="sd">            if different groupby operations on y and colorby, use dictionary to</span>
<span class="sd">            define .E.g. {&#39;y&#39;:&#39;sum&#39;,&#39;colorby&#39;:&#39;max&#39;} will perform sum on &#39;y&#39; </span>
<span class="sd">            values but color each bar by the max colorby value. The default is </span>
<span class="sd">            &#39;sum&#39;.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title of the whole plot. The default is None.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">            Label on the x-axis. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            Label on the y-axis. The default is None.</span>
<span class="sd">        fig: Optional[plt.Figure],optional</span>
<span class="sd">            Can use fig defined by the user. Needed if providing ax and requires</span>
<span class="sd">            colorbar</span>
<span class="sd">        ax : Optional[plt.Axes], optional</span>
<span class="sd">            Can use ax defined by the user. The default is None.</span>
<span class="sd">        **figkwargs : dict</span>
<span class="sd">            yscalelog:bool: if True, y-axis becomes log10scale, default False</span>
<span class="sd">            alpha: float: set the transparency of the bars. Default 0.5</span>
<span class="sd">            hline:float: if float defined, then plot a hline line on </span>
<span class="sd">                                y-axis.</span>
<span class="sd">            hline_label: label of hline</span>
<span class="sd">            rotation_x:int,float: degree of rotation on the x-ticks</span>
<span class="sd">            colorbar_axes:List[float]: if multiple subplots, then define the </span>
<span class="sd">            colorbar position. The list define the co-ordinate of the lower left</span>
<span class="sd">                corner of the color bar. The last two values defines the width </span>
<span class="sd">                and height of the bar. default is [0.85, 0.15, 0.01, 0.7]</span>
<span class="sd">            colorbar_label:str: label on the colorbar.</span>
<span class="sd">            cmap:str to color the bars if used colorby. See sns cmap for options. </span>
<span class="sd">                Default is &#39;Greens&#39;</span>
<span class="sd">            cmap_reversed: to reverse the cmap. Default False</span>
<span class="sd">            xlabel_pos: tuple(float): If multiple subplots, the define position</span>
<span class="sd">            of the x-label. Default (.48,.01)</span>
<span class="sd">            ylabel_pos:tuple(float): If multiple subplots, the define position</span>
<span class="sd">            of the x-label. Default (.1,.5)</span>
<span class="sd">            figsize:tuple(float or int): define fig size.</span>
<span class="sd">            barwidth:float: Define bar width. Default 0.35.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError</span>
<span class="sd">            colorbar_label requires colorby.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig</span>
<span class="sd">           return fig ploted </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">xlabel</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">must_be</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
        <span class="n">y</span><span class="p">,</span><span class="n">ylabel</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">y2</span><span class="p">,</span><span class="n">y2label</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">colorby</span><span class="p">,</span><span class="n">colorbar_label</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">colorby</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">separateby</span><span class="p">,</span><span class="n">plot_label</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">separateby</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">must_be</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
        <span class="n">hue</span><span class="p">,</span><span class="n">legend_label</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span><span class="n">must_be</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">colorby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1">#if both hue and colorby is present, show only hue</span>
            <span class="n">colorby</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">colorbar_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">separateby</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">separateby</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">colorby</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorby</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">y2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>

        <span class="c1">#you want to groupby x in case x is not unique.</span>
        <span class="n">to_plot_dictionary</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">Groupby</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">separateby</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">hue</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">colorby</span><span class="o">=</span><span class="n">colorby</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">to_plot_dictionary</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">Groupby</span><span class="o">.</span><span class="n">groupby_operation</span><span class="p">(</span><span class="n">to_plot_dictionary</span><span class="p">,</span>
                                                                    <span class="n">operation</span><span class="o">=</span><span class="n">groupby_operation</span><span class="p">)</span>
        
        <span class="n">all_bars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">product</span><span class="p">(</span><span class="n">separateby</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">hue</span><span class="p">)))</span> <span class="c1"># all the bars combinations</span>
        <span class="k">def</span> <span class="nf">getFromDict</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span><span class="n">mapList</span><span class="p">):</span>
            <span class="c1">#convenience function where you get the values from dictionary by passing a list of keys.</span>
            <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">getitem</span><span class="p">,</span> <span class="n">mapList</span><span class="p">,</span><span class="n">dictionary</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">get_unique</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1">#conveninece function to return unique values but in preserved order</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">new_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">_</span><span class="p">,</span><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span><span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span>
        
        <span class="n">all_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">all_bars</span><span class="p">:</span> <span class="c1"># [dict][key1][key2][key3]</span>
            <span class="n">all_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">getFromDict</span><span class="p">(</span><span class="n">to_plot_dictionary</span><span class="p">,</span><span class="n">keys</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">all_bars_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">bar</span><span class="o">+</span><span class="n">val</span> <span class="k">for</span> <span class="n">bar</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_bars</span><span class="p">,</span><span class="n">all_values</span><span class="p">)],</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;separateby&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s1">&#39;hue&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s1">&#39;colorby&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">),</span>
                                        <span class="p">(</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;order_reversed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
                <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;order_reversed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="n">all_bars_vals</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">sort_array</span><span class="p">(</span><span class="n">all_bars_vals</span><span class="p">,</span>
                                                        <span class="n">specific_order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_bars_vals</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">sort_array</span><span class="p">(</span><span class="n">all_bars_vals</span><span class="p">,</span>
                                                       <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
                                                       <span class="n">ascending</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;order_reversed&#39;</span><span class="p">])</span>
        
        <span class="n">separateby</span> <span class="o">=</span> <span class="n">all_bars_vals</span><span class="p">[</span><span class="s1">&#39;separateby&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">separateby</span><span class="p">):</span>
            <span class="n">separateby</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">all_bars_vals</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
        <span class="n">hue</span> <span class="o">=</span> <span class="n">all_bars_vals</span><span class="p">[</span><span class="s1">&#39;hue&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hue</span><span class="p">):</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">all_bars_vals</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="n">colorby</span> <span class="o">=</span> <span class="n">all_bars_vals</span><span class="p">[</span><span class="s1">&#39;colorby&#39;</span><span class="p">]</span>
        <span class="n">y2</span><span class="o">=</span> <span class="n">all_bars_vals</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span><span class="o">==</span><span class="mi">0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">colorby</span><span class="p">):</span>
            <span class="n">colorby</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span><span class="o">==</span><span class="mi">0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">y2</span><span class="p">):</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#Here you have two np.arrays: all_bars = nx3 shape where </span>
        <span class="c1">#column1=separateby column2=x column3= hue</span>
        <span class="c1">#all_values = nx2 column1 = y, column2 = colorby</span>
        
        <span class="c1"># for visualisation you can plot the bar plot separated by 3 values.</span>
        <span class="c1"># between unique x, separateby and hue values.</span>
        <span class="c1"># you can plot on the y axis and color the bars</span>
        
        <span class="n">x_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x_pos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># position on the x axis.</span>
        
        <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylabel</span>
        <span class="k">if</span> <span class="s1">&#39;yscalelog&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;yscalelog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;hline&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;hline_label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span> 
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hline_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;rotation_x&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;rotation_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s1">&#39;colorbar_axes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;colorbar_label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colorbar_label</span>
        <span class="k">if</span> <span class="s1">&#39;cmap&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;coolwarm&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;cmap_reversed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap_reversed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;legend_label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">legend_label</span>
        <span class="k">if</span> <span class="s1">&#39;legend_loc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;outside&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;plot_label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;plot_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_label</span>
        <span class="k">if</span> <span class="s1">&#39;plot_title_fontsize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;plot_title_fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="s1">&#39;xlabel_pos&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.48</span><span class="p">,</span><span class="mf">.01</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;ylabel_pos&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;barwidth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;barwidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.35</span>

        <span class="k">if</span> <span class="n">separateby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># plot different category into different plots. Useful when you want to show a common colorbar</span>
            <span class="n">uniq_separateby</span> <span class="o">=</span> <span class="n">get_unique</span><span class="p">(</span><span class="n">separateby</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniq_separateby</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq_separateby</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
                <span class="n">column</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span><span class="mi">1</span>
                <span class="n">column</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniq_separateby</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">column</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">colorby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># color of the bar, it will be consistent across multiple plots if seperateby is defined.</span>
            <span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">colorby</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap_reversed&#39;</span><span class="p">]:</span>
                <span class="n">pal</span> <span class="o">=</span> <span class="n">pal</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="n">colorby</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="n">my_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">pal</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">colorby</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">colorby</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">my_cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
            <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pal</span><span class="p">)[</span><span class="n">rank</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;yscalelog&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">plot_group_bar_chart</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span>
                                     <span class="n">y</span><span class="p">,</span>
                                     <span class="n">barwidth</span><span class="p">,</span>
                                     <span class="n">label_idx</span><span class="p">,</span>
                                     <span class="n">label</span><span class="p">,</span>
                                     <span class="n">unique_hue</span><span class="p">,</span>
                                     <span class="n">ax</span><span class="p">,</span>
                                     <span class="n">y2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">mean_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">label_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">mean_pos</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_pos</span><span class="o">+</span><span class="p">(</span><span class="n">shift</span><span class="o">*</span><span class="n">barwidth</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">)),</span>
                           <span class="n">y</span><span class="p">,</span>
                           <span class="n">barwidth</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">),</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">label_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mean_pos</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_pos</span><span class="o">+</span><span class="p">(</span><span class="n">shift</span><span class="o">*</span><span class="p">(</span><span class="n">barwidth</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">))),</span>
                           <span class="n">y</span><span class="p">,</span>
                           <span class="p">(</span><span class="n">barwidth</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">)),</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
            
                <span class="k">return</span> <span class="n">ax</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">separateby</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">current_separateby_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">separateby</span><span class="o">==</span><span class="n">uniq_separateby</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="c1">#this is because you have empty subplots</span>
                    <span class="k">continue</span>
                <span class="n">temp_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">current_separateby_index</span><span class="p">]</span>
                <span class="n">sort_indices_in_x</span> <span class="o">=</span> <span class="n">temp_x</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                <span class="n">temp_x</span> <span class="o">=</span> <span class="n">temp_x</span><span class="p">[</span><span class="n">sort_indices_in_x</span><span class="p">]</span>
                <span class="n">temp_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">current_separateby_index</span><span class="p">]</span>
                <span class="n">temp_y</span> <span class="o">=</span> <span class="n">temp_y</span><span class="p">[</span><span class="n">sort_indices_in_x</span><span class="p">]</span>
                <span class="n">temp_x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">temp_x</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">temp_hue</span> <span class="o">=</span> <span class="n">hue</span><span class="p">[</span><span class="n">current_separateby_index</span><span class="p">]</span>
                    <span class="n">temp_hue</span> <span class="o">=</span> <span class="n">temp_hue</span><span class="p">[</span><span class="n">sort_indices_in_x</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp_hue</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color_separately</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="n">current_separateby_index</span><span class="p">]</span>
                    <span class="n">color_separately</span> <span class="o">=</span> <span class="n">color_separately</span><span class="p">[</span><span class="n">sort_indices_in_x</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color_separately</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">unique_hue</span> <span class="o">=</span> <span class="n">get_unique</span><span class="p">(</span><span class="n">hue</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">label_idx</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">):</span>
                        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_group_bar_chart</span><span class="p">(</span><span class="n">temp_x_pos</span><span class="p">,</span> 
                                             <span class="n">temp_y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp_hue</span> <span class="o">==</span> <span class="n">label</span><span class="p">)],</span>
                                             <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;barwidth&#39;</span><span class="p">],</span> 
                                             <span class="n">label_idx</span><span class="p">,</span> 
                                             <span class="n">label</span><span class="p">,</span> 
                                             <span class="n">unique_hue</span><span class="p">,</span>
                                             <span class="n">ax</span><span class="p">,</span>
                                             <span class="n">color</span><span class="o">=</span><span class="n">color_separately</span><span class="p">,</span>
                                             <span class="n">alpha</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#plot point plot on the second plot</span>
                            <span class="k">pass</span>
                            
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">temp_x_pos</span><span class="p">,</span><span class="n">temp_y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_separately</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;plot_label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;plot_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;plot_label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="n">uniq_separateby</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;plot_title_fontsize&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">temp_x_pos</span><span class="p">,</span><span class="n">get_unique</span><span class="p">(</span><span class="n">temp_x</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">unique_hue</span> <span class="o">=</span> <span class="n">get_unique</span><span class="p">(</span><span class="n">hue</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">label_idx</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_hue</span><span class="p">):</span>
                        <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_group_bar_chart</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> 
                                             <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hue</span> <span class="o">==</span> <span class="n">label</span><span class="p">)],</span>
                                             <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;barwidth&#39;</span><span class="p">],</span> 
                                             <span class="n">label_idx</span><span class="p">,</span> 
                                             <span class="n">label</span><span class="p">,</span> 
                                             <span class="n">unique_hue</span><span class="p">,</span>
                                             <span class="n">ax</span><span class="p">,</span>
                                             <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                             <span class="n">alpha</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
                    
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span><span class="n">get_unique</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hline&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hline&#39;</span><span class="p">],</span>
                          <span class="n">x_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;barwidth&#39;</span><span class="p">],</span>
                          <span class="n">x_pos</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;barwidth&#39;</span><span class="p">],</span>
                          <span class="n">label</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hline_label&#39;</span><span class="p">],</span>
                          <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;xlabel_fontdict&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
                <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel_fontdict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
            
            <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                                   <span class="n">rotation</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;rotation_x&#39;</span><span class="p">],</span>
                                   <span class="n">labelsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel_fontdict&#39;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                               <span class="n">rotation</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;rotation_x&#39;</span><span class="p">],</span>
                               <span class="n">labelsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel_fontdict&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hline_label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;outside&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colorby</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;you have not defined colorby and you want to have a color label&#39;</span><span class="p">)</span>
            <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_axes&#39;</span><span class="p">])</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.80</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel_pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
                     <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel_pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> 
                     <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">],</span> 
                     <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel_pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel_pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">],</span>
                     <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="SimplePlots.Scatter"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.SimplePlots.Scatter">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">Scatter</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span><span class="nb">list</span><span class="p">],</span>
                <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span><span class="nb">list</span><span class="p">],</span>
                <span class="n">colorby</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">hue</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">annotate</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">combined</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">fig</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">ax</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">stats</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">adjust_covar</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">scaling</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">figkwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit linear regression, where y~x. calculates the pval and beta coefficient.</span>
<span class="sd">        </span>
<span class="sd">        You can use it to visualise across different populations and generate separate pval and beta coeficient for each population (hue) or for all of them combined</span>
<span class="sd">        Note: when you have two variables, the pearson&#39;s correlation coefficient is the same as the standardized beta coefs.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : Union[np.ndarray, pd.DataFrame, pd.Series, str]</span>
<span class="sd">            value on x.</span>
<span class="sd">        y : Union[np.ndarray, pd.DataFrame, pd.Series, str]</span>
<span class="sd">            value on y.</span>
<span class="sd">        data : Optional[pd.DataFrame], optional</span>
<span class="sd">            if providing string x,y, then data will be the dataframe. The default is None.</span>
<span class="sd">        hue : Optional[str], optional</span>
<span class="sd">            separate data point by another value in the dataframe (e.g. cohort). It will calculate separate beta and p-value. The default is None.</span>
<span class="sd">        combined : Optional[bool], optional</span>
<span class="sd">            If use, calculate the total (for all hues) p-val and beta coefs. The default is False.</span>
<span class="sd">        title : str, optional</span>
<span class="sd">            Title of the graph. The default is None.</span>
<span class="sd">        xlabel : str, optional</span>
<span class="sd">             label on x axis. The default is None.</span>
<span class="sd">        ylabel : str, optional</span>
<span class="sd">            label on y axis. The default is None.</span>
<span class="sd">        axes : np.array, optional</span>
<span class="sd">            if provided plt.subplots. The default is None.</span>
<span class="sd">        scaling : str, optional</span>
<span class="sd">            whether to scale x and y. The default is &#39;both&#39;.</span>
<span class="sd">        **figkwargs :</span>
<span class="sd">            linewdith: float</span>
<span class="sd">            markersize: float</span>
<span class="sd">            legend_loc {outside, inside}</span>
<span class="sd">            hide_CI=False</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            The ax plot.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;colorbar_label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;colorbar_axes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;cmap&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Blues&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;cmap_reversed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap_reversed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;edgecolors&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;edgecolors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;face&#39;</span>
        
        
        <span class="n">x</span><span class="p">,</span><span class="n">xlabel</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                                               <span class="n">data</span><span class="p">,</span>
                                               <span class="n">variable_label</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">])</span>
        <span class="n">y</span><span class="p">,</span><span class="n">ylabel</span><span class="p">,</span><span class="n">column_names</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                                                          <span class="n">data</span><span class="p">,</span>
                                                          <span class="n">variable_label</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">])</span>
        <span class="n">colorby</span><span class="p">,</span><span class="n">colorbar_label</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">colorby</span><span class="p">,</span>
                                                    <span class="n">data</span><span class="p">,</span>
                                                    <span class="n">variable_label</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">])</span>
        <span class="n">annotate</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">return_array</span><span class="p">(</span><span class="n">annotate</span><span class="p">,</span>
                                                 <span class="n">data</span><span class="p">,</span>
                                                 <span class="n">variable_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">color</span><span class="p">,</span><span class="n">scalar_mappable</span> <span class="o">=</span> <span class="n">SimplePlots</span><span class="o">.</span><span class="n">get_color_pallete</span><span class="p">(</span><span class="n">colorby</span><span class="p">,</span>
                                                               <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span>
                                                               <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap_reversed&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">adjust_covar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;x&#39;</span> <span class="ow">in</span> <span class="n">adjust_covar</span><span class="p">:</span>
                <span class="n">cat_independentVar_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">independentVar</span> <span class="k">for</span> <span class="n">independentVar</span> <span class="ow">in</span> <span class="n">adjust_covar</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">independentVar</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">]</span>
                <span class="n">cont_independentVar_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">independentVar</span> <span class="k">for</span> <span class="n">independentVar</span> <span class="ow">in</span> <span class="n">adjust_covar</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">independentVar</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_independentVar_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cat_independentVar_cols</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cont_independentVar_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cont_independentVar_cols</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">adj_x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">MassUnivariate</span><span class="o">.</span><span class="n">adjust_covariates_with_lin_reg</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                                                                       <span class="n">cat_independentVar_cols</span><span class="o">=</span><span class="n">cat_independentVar_cols</span><span class="p">,</span>
                                                                                       <span class="n">cont_independentVar_cols</span><span class="o">=</span><span class="n">cont_independentVar_cols</span><span class="p">,</span>
                                                                                       <span class="n">dependentVar_cols</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">adj_x</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Adj. </span><span class="si">{</span><span class="n">xlabel</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">adjust_covar</span><span class="p">:</span>
                <span class="n">cat_independentVar_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">independentVar</span> <span class="k">for</span> <span class="n">independentVar</span> <span class="ow">in</span> <span class="n">adjust_covar</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">independentVar</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">]</span>
                <span class="n">cont_independentVar_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">independentVar</span> <span class="k">for</span> <span class="n">independentVar</span> <span class="ow">in</span> <span class="n">adjust_covar</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">independentVar</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_independentVar_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cat_independentVar_cols</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cont_independentVar_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cont_independentVar_cols</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">adj_y</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">MassUnivariate</span><span class="o">.</span><span class="n">adjust_covariates_with_lin_reg</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                                                                       <span class="n">cat_independentVar_cols</span><span class="o">=</span><span class="n">cat_independentVar_cols</span><span class="p">,</span>
                                                                                       <span class="n">cont_independentVar_cols</span><span class="o">=</span><span class="n">cont_independentVar_cols</span><span class="p">,</span>
                                                                                       <span class="n">dependentVar_cols</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">adj_y</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Adj. </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Adj. </span><span class="si">{</span><span class="n">ylabel</span><span class="si">}</span><span class="s1">&#39;</span>
                        
        <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span><span class="c1">#if y is defined as list, then hue is automatically applied</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">column_names</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Hue_</span><span class="si">{</span><span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">column_names</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">y</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">column_names</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            
            <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hue&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
            <span class="n">hue</span> <span class="o">=</span> <span class="s1">&#39;hue&#39;</span>

        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="s1">&#39;linewidth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">if</span> <span class="s1">&#39;markersize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">if</span> <span class="s1">&#39;fontsize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span><span class="mi">10</span>
        <span class="k">if</span> <span class="s1">&#39;hide_CI&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hide_CI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">def</span> <span class="nf">plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                     <span class="n">y</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">annotate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">unique_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">combined</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                     <span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">,</span>
                     <span class="n">edgecolors</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;edgecolors&#39;</span><span class="p">]):</span>
            <span class="c1">#calculating the mass univariate</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">MassUnivariate</span><span class="o">.</span><span class="n">mass_univariate</span><span class="p">(</span><span class="n">cont_independentVar_cols</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                                                                       <span class="n">dependentVar_cols</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                                                                       <span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>  <span class="c1"># will perform standaridzation inside the function</span>
            <span class="k">if</span> <span class="n">scaling</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">scaling</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">scaling</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="c1"># get the beta and calculate p-value for the regression model</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">()</span>
            <span class="n">df_predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">()</span>
            <span class="n">sorted_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p_value</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">pvalues</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">unique_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#calculate the correlation label</span>
                <span class="n">corr_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$r$=</span><span class="si">%0.03f</span><span class="s1">, pval = </span><span class="si">%0.03f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">p_value</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">combined</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">],</span><span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">stats</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">corr_label</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">annotate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">text_id</span><span class="p">,</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">annotate</span><span class="p">):</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span><span class="p">,(</span><span class="n">x</span><span class="p">[</span><span class="n">text_id</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">text_id</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">])</span>
                    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">corr_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">handles</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hide_CI&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">df_predictions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span> <span class="s1">&#39;mean_ci_lower&#39;</span><span class="p">],</span> <span class="n">df_predictions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span>
                                    <span class="s1">&#39;mean_ci_upper&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">unique_label</span><span class="p">)</span>
    
            <span class="k">else</span><span class="p">:</span>
                <span class="n">corr_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$r$=</span><span class="si">%0.03f</span><span class="s1">, pval = </span><span class="si">%0.03f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">p_value</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">unique_label</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;markersize&#39;</span><span class="p">])</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">corr_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">handles</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span><span class="n">linewidth</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;hide_CI&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">df_predictions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span> <span class="s1">&#39;mean_ci_lower&#39;</span><span class="p">],</span> <span class="n">df_predictions</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sorted_x</span><span class="p">,</span>
                                    <span class="s1">&#39;mean_ci_upper&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">,</span><span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">unique_hues</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">hue</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">unique_hue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_hues</span><span class="p">):</span>
                <span class="n">temp_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">hue</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_hue</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                <span class="n">plotting</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">temp_data</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">temp_data</span><span class="p">],</span>
                         <span class="n">unique_label</span><span class="o">=</span><span class="n">unique_hue</span><span class="p">,</span><span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">combined</span><span class="p">:</span>
                <span class="n">plotting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">combined</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">)</span>
    
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;you have not defined colorby and you want to have a color label&#39;</span><span class="p">)</span>
            <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_axes&#39;</span><span class="p">])</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalar_mappable</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;colorbar_label&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;legend&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;legend_loc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
                <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;outside&#39;</span>
            <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;outside&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div></div>


<div class="viewcode-block" id="draw_box_plots"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.draw_box_plots">[docs]</a><span class="k">def</span> <span class="nf">draw_box_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                   <span class="n">dependentVar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">independentVar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">percentage</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                   <span class="n">ancestry_PCs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    draw box plots by dividing the dataset into high and low risk</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">independentVar</span><span class="p">:</span>
        <span class="n">measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">dependentVar</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">measure</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">MassUnivariate</span><span class="o">.</span><span class="n">adjust_covariates_with_lin_reg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="n">dependentVar</span><span class="p">]),</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">independentVar</span><span class="p">]))</span>

    <span class="n">high_risk</span><span class="p">,</span> <span class="n">low_risk</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">divide_high_low_risk</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">MassUnivariate</span><span class="o">.</span><span class="n">adjust_covariates_with_lin_reg</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">threshold</span><span class="p">]),</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ancestry_PCs</span><span class="p">])),</span> <span class="n">low_perc</span><span class="o">=</span><span class="n">percentage</span><span class="p">,</span> <span class="n">high_perc</span><span class="o">=</span><span class="n">percentage</span><span class="p">)</span>

    <span class="n">measure_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;measure&#39;</span><span class="p">:</span> <span class="n">measure</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;risk&#39;</span><span class="p">:</span> <span class="p">[</span>
                              <span class="s1">&#39;high risk&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">high_risk</span> <span class="k">else</span> <span class="s1">&#39;low risk&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">low_risk</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">measure</span><span class="p">))]})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">stats</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">measure_df</span><span class="p">[</span><span class="n">measure_df</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;low risk&#39;</span><span class="p">][</span><span class="s1">&#39;measure&#39;</span><span class="p">],</span>
                            <span class="n">measure_df</span><span class="p">[</span><span class="n">measure_df</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;high risk&#39;</span><span class="p">][</span><span class="s1">&#39;measure&#39;</span><span class="p">],</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">low_risk_mean</span> <span class="o">=</span> <span class="n">measure_df</span><span class="p">[</span><span class="n">measure_df</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">]</span>
                               <span class="o">==</span> <span class="s1">&#39;low risk&#39;</span><span class="p">][</span><span class="s1">&#39;measure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">high_risk_mean</span> <span class="o">=</span> <span class="n">measure_df</span><span class="p">[</span><span class="n">measure_df</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">]</span>
                                <span class="o">==</span> <span class="s1">&#39;high risk&#39;</span><span class="p">][</span><span class="s1">&#39;measure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;risk&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;measure&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">measure_df</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">independentVar</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;corrected &#39;</span> <span class="o">+</span> <span class="n">ylabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;t-test pval=</span><span class="si">%0.03f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pval</span><span class="p">))</span></div>

<div class="viewcode-block" id="Brainmap"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Brainmap">[docs]</a><span class="k">class</span> <span class="nc">Brainmap</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is used to plot the brain visualisations using nibable</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        atlas_file = the nibabel loaded image</span>
<span class="sd">        atlas = the numpy array representation of nifti image</span>
<span class="sd">        cmap = the color scheme</span>
<span class="sd">        </span>
<span class="sd">    Methods:</span>
<span class="sd">        get_edges</span>
<span class="sd">            used to get the visualise the segmentation outline</span>
<span class="sd">        plot_segmentation</span>
<span class="sd">            plot the segmentations with filled in color and legend</span>
<span class="sd">        get_ROIs_coordinates</span>
<span class="sd">            get the X,Y,Z coordinates of different regions in the Nifti file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">atlas_file</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">nib</span><span class="o">.</span><span class="n">nifti1</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">],</span>
                 <span class="n">cmap</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;Spectral&#39;</span><span class="p">,</span><span class="n">cmap_reversed</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atlas_file : Union[str,nib.nifti1.Nifti1Image]</span>
<span class="sd">            The path to the Nifti file or the nibable loaded nifti image.</span>
<span class="sd">        cmap : str, optional</span>
<span class="sd">            The color scheme. The default is &#39;Spectral&#39;.</span>
<span class="sd">        cmap_reversed : bool, optional</span>
<span class="sd">            Reverse the color scheme. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atlas_file</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">,</span><span class="n">nib</span><span class="o">.</span><span class="n">nifti1</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atlas_file</span> <span class="o">=</span> <span class="n">atlas_file</span>
        <span class="n">atlas_affine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlas_file</span><span class="o">.</span><span class="n">affine</span>
        <span class="k">if</span> <span class="n">nib</span><span class="o">.</span><span class="n">aff2axcodes</span><span class="p">(</span><span class="n">atlas_affine</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">):</span> <span class="c1"># if it is not RAS orientation, change to it.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atlas_file</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">as_closest_canonical</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atlas_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atlas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlas_file</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># set transparency of np.nan numbers into 0</span>
        <span class="k">if</span> <span class="n">cmap_reversed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">reversed</span><span class="p">()</span>
    
<div class="viewcode-block" id="Brainmap.get_edges"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Brainmap.get_edges">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="n">outline</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span> <span class="c1"># use in brain_segmentation</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the edges of a structure.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        outline:np.ndarray : </span>
<span class="sd">            array of number, edges will be drawn around the edges of the non-zero structures.</span>
<span class="sd">            If two pixels next to each other are non-zero, then a black rectangle is drawn.</span>
<span class="sd">            If two pixels are non-zero and not next to each other, then two black squares are drawn.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#for each pixel colour the edges.</span>
        <span class="n">rr</span><span class="p">,</span><span class="n">cc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
        <span class="n">switcheroo</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="c1"># the imshow and the np.matrix have different coordinates</span>
        <span class="k">def</span> <span class="nf">check_sides</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">outline</span><span class="p">):</span>
            <span class="n">sides</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;left&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
            <span class="c1">#the key is visualise that the 0,0 of the numpy matrix is upper left.</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">outline</span><span class="p">[</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">]:</span>
                <span class="c1"># top edge</span>
                <span class="n">sides</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="n">outline</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">outline</span><span class="p">[</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">]:</span>
                <span class="c1"># bottom edge</span>
                <span class="n">sides</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">outline</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># left edge</span>
                <span class="n">sides</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">outline</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">outline</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># right edge</span>
                <span class="n">sides</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">sides</span>
        
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">cc</span><span class="p">):</span>
            <span class="n">ul_coord</span> <span class="o">=</span> <span class="n">switcheroo</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="c1"># upper left</span>
            <span class="n">ll_coord</span> <span class="o">=</span> <span class="n">switcheroo</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="c1"># lower left</span>
            <span class="n">ur_coord</span> <span class="o">=</span> <span class="n">switcheroo</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># upper right</span>
            <span class="n">lr_coord</span> <span class="o">=</span> <span class="n">switcheroo</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="c1"># lower right</span>
            
            <span class="n">sides_dict</span> <span class="o">=</span> <span class="n">check_sides</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">outline</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sides_dict</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ul_coord</span><span class="p">,</span><span class="n">ur_coord</span><span class="p">])</span><span class="c1"># top edge</span>
            <span class="k">if</span> <span class="n">sides_dict</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ll_coord</span><span class="p">,</span><span class="n">lr_coord</span><span class="p">])</span><span class="c1"># bottom edge</span>
            <span class="k">if</span> <span class="n">sides_dict</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ul_coord</span><span class="p">,</span><span class="n">ll_coord</span><span class="p">])</span><span class="c1"># left edge</span>
            <span class="k">if</span> <span class="n">sides_dict</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ur_coord</span><span class="p">,</span><span class="n">lr_coord</span><span class="p">])</span><span class="c1"># right edge</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span></div>
    
<div class="viewcode-block" id="Brainmap.plot_segmentation"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Brainmap.plot_segmentation">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">plot_segmentation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                         <span class="n">map_view</span><span class="p">:</span><span class="n">List</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span>
                         <span class="n">atlas_slice</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">dict</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">regions_to_hide</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">plot_values</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">plot_values_threshold</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">mask</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">fig</span><span class="p">:</span><span class="n">mpl</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">axes</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="n">List</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">colorbar</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">label_legend</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">legends</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">atlas_file</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">nib</span><span class="o">.</span><span class="n">nifti1</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;Spectral&#39;</span><span class="p">,</span><span class="n">plot_orientation</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">figkwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the brain segmentation</span>
<span class="sd">        </span>
<span class="sd">        Note:</span>
<span class="sd">            Essentially, two brain maps are created.</span>
<span class="sd">            The original brain map is used to create segmentation outline.</span>
<span class="sd">            The second brain map is used to fill in the color.</span>
<span class="sd">            </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        map_view : List, optional</span>
<span class="sd">            {&#39;all&#39;,&#39;sagittal&#39;,&#39;axial&#39;,&#39;coronal&#39;}. The default is [&#39;all&#39;].</span>
<span class="sd">        atlas_slice: int,list, dict, optional</span>
<span class="sd">            dictionary keys: axial, coronal, sagittal, values = slice number</span>
<span class="sd">            if list: three numbers corresponds to axial, coronal, sagittal</span>
<span class="sd">            Choose which slice to show, else middle slice will be shown.</span>
<span class="sd">        regions_to_hide : list, optional</span>
<span class="sd">            Give the list of regions to hide (the regions must be list of intergers) The labels will be set to transparency 0. The default is None.</span>
<span class="sd">        plot_values : Union[dict], optional</span>
<span class="sd">            plot a color for each label denoting the strength of p-value or some other metrics.</span>
<span class="sd">            If provide a dictionary, the key will be the label, and the value will be the value. The default is None.</span>
<span class="sd">        plot_values_threshold:float, optional</span>
<span class="sd">            A number that can be applied to plot_values and set the ones that do not pass the threshold to np.nan</span>
<span class="sd">        mask : Union[dict], optional</span>
<span class="sd">            Can pass a mask, that after passing the plot_values threshold, instead of plotting the original plot_values, the mask will be plotted instead.</span>
<span class="sd">            E.g. I have p-values as plot_values, but I want to plot beta- coefficients that has p-value &lt;0.05 instead. Here the dict of beta coef is the mask.</span>
<span class="sd">        fig : mpl.figure.Figure, optional</span>
<span class="sd">            Can specify the fig, if not fig will be created. The default is None.</span>
<span class="sd">        axes : Union[np.ndarray,List], optional</span>
<span class="sd">            Can provide the specific axes, list of axes. If not axes will be created. The default is None.</span>
<span class="sd">        colorbar : bool, optional</span>
<span class="sd">            If plot_values is specified, then can choose if to plot the colorbar. The default is False.</span>
<span class="sd">        label_legend : dict, optional</span>
<span class="sd">            If not using the plot_values, but you want to show the segmentation.</span>
<span class="sd">            Each color patch in the legend will correspond to the color in the plot</span>
<span class="sd">            Must provide a dictionary, where the key is interger denoting the label.</span>
<span class="sd">            And value is the string abbreviation. The default is None.</span>
<span class="sd">        atlas_file : Union[str,nib.nifti1.Nifti1Image], optional</span>
<span class="sd">            The path to the nifti file, or the nib.load(Nifti file). The default is None.</span>
<span class="sd">        cmap : str, optional</span>
<span class="sd">            The color scheme. The default is &#39;Spectral&#39;.</span>
<span class="sd">        plot_orientation: bool, optional</span>
<span class="sd">            If you want to plot the axis in the RAS coordinate.</span>
<span class="sd">        **figkwargs : TYPE</span>
<span class="sd">            cmap_reversed = if you want to revese the cmap default False</span>
<span class="sd">            cb_orientation = {&#39;horizontal&#39;,&#39;vertical&#39;} if you want your change your colorbar orientation. Default horizontal next to the last axes.</span>
<span class="sd">            cb_title = str. name of the colorbar</span>
<span class="sd">            figsize = Default (20,10)</span>
<span class="sd">            outline_label_legends: bool. Default True. The outline is updated if the the same legend is found in two regions.</span>
<span class="sd">            outline_regions_to_hide: bool. Default True. The outline is not updated after using regions_to_hide. </span>
<span class="sd">            label_legend_bbox_to_anchor:(-2.5, -1,0,0)</span>
<span class="sd">            label_legend_ncol : 6</span>
<span class="sd">            label_legend_loc: &#39;lower left&#39;</span>
<span class="sd">            label_legend_fontsize: &#39;medium&#39; or float</span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>
<span class="sd">        AttributeError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : TYPE</span>
<span class="sd">            The mpl.Figure either created or used.</span>
<span class="sd">        map_view_dict : TYPE</span>
<span class="sd">            a dictionary containing all atlas array, including &#39;im&#39; plotted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;cmap_reversed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap_reversed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">brain_map</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">,</span><span class="n">cmap</span><span class="p">,</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cmap_reversed&#39;</span><span class="p">])</span>
        <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># set the background to 0 transparency</span>
        <span class="c1">#the following original atlas are needed for the outline.</span>
        <span class="n">atlas_slice_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;axial&#39;</span><span class="p">:</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span>
                         <span class="s1">&#39;coronal&#39;</span><span class="p">:</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span>
                         <span class="s1">&#39;sagittal&#39;</span><span class="p">:</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atlas_slice</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;axial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atlas_slice</span>
            <span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;coronal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atlas_slice</span>
            <span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;sagittal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atlas_slice</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atlas_slice</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atlas_slice</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;atlas slice must be 3, stands for axial, coronal, sagittal&#39;</span><span class="p">)</span>
            <span class="n">atlas_slices</span> <span class="o">=</span> <span class="p">[</span><span class="n">slice_int</span> <span class="k">if</span> <span class="n">slice_int</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="k">for</span> <span class="n">slice_int</span> <span class="ow">in</span> <span class="n">atlas_slice</span><span class="p">]</span>
            <span class="n">atlas_slice_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;axial&#39;</span><span class="p">,</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span><span class="s1">&#39;sagittal&#39;</span><span class="p">],</span><span class="n">atlas_slices</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atlas_slice</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">atlas_slice</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">atlas_slice_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>                
        
        <span class="c1">#original atlases are used to delineate the outline</span>
        <span class="n">original_axial_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;axial&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">original_coronal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;coronal&#39;</span><span class="p">],:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">original_sagittal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;sagittal&#39;</span><span class="p">],:,:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">label_legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1"># if legend dictionary is provided</span>
            <span class="n">unique_regions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">)])</span> <span class="c1">#not labelling the np.nan values</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">unique_regions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">region</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">label_legend</span><span class="p">:</span>
                    <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="o">==</span><span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1">#regions that are not provided in the legend they are removed from colouring.</span>
            
            <span class="c1">#check for unique legends- basically group the labels/ regions if the legend is the same. the original outline will still be shown</span>
            <span class="n">unique_legends</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">label_legend</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> 
            <span class="c1">#essentially if 2 keys denote the same value, you get a new dictionary: {Value:[key1,key2,etc.]}</span>
            <span class="n">legend_label</span> <span class="o">=</span> <span class="p">{</span><span class="n">uniq_leg</span><span class="p">:[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">label_legend</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">label_legend</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">uniq_leg</span><span class="p">]</span> <span class="k">for</span> <span class="n">uniq_leg</span> <span class="ow">in</span> <span class="n">unique_legends</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">legend</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="n">legend_label</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">label</span><span class="p">:</span>
                        <span class="c1">#if more than one key show the same value, then change it to the same key.</span>
                        <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="o">==</span><span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="s1">&#39;outline_label_legends&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span> <span class="c1"># whether to outline only the keys in the legend</span>
                <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;outline_label_legends&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;outline_label_legends&#39;</span><span class="p">]:</span>
                <span class="n">original_axial_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;axial&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">original_coronal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;coronal&#39;</span><span class="p">],:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">original_sagittal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;sagittal&#39;</span><span class="p">],:,:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c1"># the following regions need to be hide (but outline will still be shown)</span>
        <span class="k">if</span> <span class="n">regions_to_hide</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions_to_hide</span><span class="p">:</span>
                <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span> <span class="o">==</span> <span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="s1">&#39;outline_regions_to_hide&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
                    <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;outline_regions_to_hide&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;outline_regions_to_hide&#39;</span><span class="p">]:</span>
                    <span class="n">original_axial_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;axial&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">original_coronal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;coronal&#39;</span><span class="p">],:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">original_sagittal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;sagittal&#39;</span><span class="p">],:,:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
                
                
        <span class="k">if</span> <span class="n">plot_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plot_values</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;plot_values needs to be a dictionary, where keys are the label, and values are the plot values&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unique_regions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">plot_values_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;mask needs to be a dictionary, where keys are the label, and values are the plot values&#39;</span><span class="p">)</span>
                        <span class="n">plot_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">indx</span><span class="p">:</span><span class="n">mask</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">indx</span> <span class="ow">in</span> <span class="n">plot_values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="n">plot_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">&gt;</span><span class="n">plot_values_threshold</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">indx</span> <span class="ow">in</span> <span class="n">mask</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="n">unique_regions</span><span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plot_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">indx</span><span class="p">:</span><span class="n">plot_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">indx</span> <span class="ow">in</span> <span class="n">plot_values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="n">plot_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">&gt;</span><span class="n">plot_values_threshold</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="n">unique_regions</span><span class="p">}</span>                  
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_values</span> <span class="o">=</span> <span class="p">{</span><span class="n">indx</span><span class="p">:</span><span class="n">plot_values</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="k">if</span> <span class="n">indx</span> <span class="ow">in</span> <span class="n">plot_values</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="n">unique_regions</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">region</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">plot_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span> <span class="o">==</span> <span class="n">region</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
        <span class="k">if</span> <span class="s1">&#39;figsize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">map_view</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">map_view</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span> <span class="c1"># because when I zip in zip(map_view,axes) I can&#39;t zip len of 1? and len(axessubplot) doesnt return anything :)))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">map_view</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;need 3 axes&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">map_view</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;number of map_view does not match number of axes provided&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">plot_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">colorbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Need fig element to plot the colorbar&#39;</span><span class="p">)</span>
        
        <span class="c1">#</span>
        <span class="n">axial_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;axial&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">coronal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[:,</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;coronal&#39;</span><span class="p">],:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">sagittal_atlas</span> <span class="o">=</span> <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">atlas_slice_dict</span><span class="p">[</span><span class="s1">&#39;sagittal&#39;</span><span class="p">],:,:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">map_view_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">map_view</span><span class="p">:</span>
            <span class="n">map_view</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;axial&#39;</span><span class="p">,</span><span class="s1">&#39;coronal&#39;</span><span class="p">,</span><span class="s1">&#39;sagittal&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">view</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">map_view</span><span class="p">,</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s1">&#39;axial&#39;</span><span class="p">:</span>
                <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axial_atlas</span>
                <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;original_atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_axial_atlas</span>
            <span class="k">elif</span> <span class="n">view</span> <span class="o">==</span> <span class="s1">&#39;coronal&#39;</span><span class="p">:</span>
                <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coronal_atlas</span>
                <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;original_atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_coronal_atlas</span>
            <span class="k">elif</span> <span class="n">view</span> <span class="o">==</span> <span class="s1">&#39;sagittal&#39;</span><span class="p">:</span>
                <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sagittal_atlas</span>
                <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;original_atlas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_sagittal_atlas</span>
        
        <span class="c1">#plot the images</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">map_view_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">map_view_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

        <span class="k">for</span> <span class="n">view</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="n">map_view_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;im&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]),</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">brain_map</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>
    
            <span class="c1">#plot the outlines</span>
            <span class="n">temp_original_atlas</span> <span class="o">=</span> <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;original_atlas&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">unique_label</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">temp_original_atlas</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp_original_atlas</span><span class="p">)]):</span>
                <span class="c1">#if it is that label, draw the outline</span>
                <span class="n">temp_outline_atlas</span> <span class="o">=</span> <span class="n">temp_original_atlas</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">temp_outline_atlas</span><span class="p">[</span><span class="n">temp_outline_atlas</span> <span class="o">!=</span> <span class="n">unique_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># if it is not that label, set the pixel to 0</span>
                <span class="n">temp_outline_atlas</span><span class="p">[</span><span class="n">temp_outline_atlas</span> <span class="o">==</span> <span class="n">unique_label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># basically draw the border where there is pixel value 1</span>
                <span class="n">temp_line</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">temp_outline_atlas</span><span class="p">)),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">temp_line</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;cb_orientation&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cb_orientation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
        <span class="c1">#add the colorbar?</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span> <span class="c1"># the colorbar is added to the last im</span>
            <span class="k">if</span> <span class="n">plot_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;need plot value to have colorbar&#39;</span><span class="p">)</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;im&#39;</span><span class="p">],</span><span class="n">ax</span> <span class="o">=</span> <span class="n">map_view_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;ax&#39;</span><span class="p">],</span> <span class="n">orientation</span> <span class="o">=</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cb_orientation&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;cb_title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
                <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cb_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cb_orientation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cb_title&#39;</span><span class="p">],</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cb_orientation&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;cb_title&#39;</span><span class="p">],</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;label_legend_bbox_to_anchor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_bbox_to_anchor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;label_legend_ncol&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_ncol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">if</span> <span class="s1">&#39;label_legend_loc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;label_legend_fontsize&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">figkwargs</span><span class="p">:</span>
            <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;medium&#39;</span>
        <span class="k">if</span> <span class="n">label_legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#to plot legends?</span>
            <span class="k">if</span> <span class="n">legends</span><span class="p">:</span>
                <span class="c1">#get the unique labels</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">map_view</span><span class="p">]))</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span> <span class="c1">#not labelling the np.nan values</span>
                <span class="c1"># get the colors of the values, according to the </span>
                <span class="c1"># colormap used by imshow</span>
                <span class="n">temp_im</span> <span class="o">=</span> <span class="n">map_view_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;im&#39;</span><span class="p">]</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_im</span><span class="o">.</span><span class="n">cmap</span><span class="p">(</span><span class="n">temp_im</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
                <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label_legend</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">label_legend</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span> 
                           <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_bbox_to_anchor&#39;</span><span class="p">],</span> 
                           <span class="n">loc</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_loc&#39;</span><span class="p">],</span>
                           <span class="n">ncol</span><span class="o">=</span><span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_ncol&#39;</span><span class="p">],</span>
                           <span class="n">fontsize</span> <span class="o">=</span> <span class="n">figkwargs</span><span class="p">[</span><span class="s1">&#39;label_legend_fontsize&#39;</span><span class="p">],</span>
                           <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">map_view</span><span class="p">:</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            
        <span class="k">if</span> <span class="n">plot_orientation</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">view</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="n">map_view_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># map_view_dict[view][&#39;ax&#39;].axhline(map_view_dict[view][&#39;atlas&#39;].shape[1]//2,alpha=0.1)</span>
                <span class="c1"># map_view_dict[view][&#39;ax&#39;].axvline(map_view_dict[view][&#39;atlas&#39;].shape[0]//2,alpha=0.1)</span>
                <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s1">&#39;axial&#39;</span><span class="p">:</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">view</span> <span class="o">==</span> <span class="s1">&#39;coronal&#39;</span><span class="p">:</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">view</span> <span class="o">==</span> <span class="s1">&#39;sagittal&#39;</span><span class="p">:</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
                    <span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">map_view_dict</span><span class="p">[</span><span class="n">view</span><span class="p">][</span><span class="s1">&#39;atlas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">map_view_dict</span></div>
        
    
<div class="viewcode-block" id="Brainmap.get_ROIs_coordinates"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Brainmap.get_ROIs_coordinates">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_ROIs_coordinates</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                             <span class="n">atlas_file</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">nib</span><span class="o">.</span><span class="n">nifti1</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get ROIs coordinate where the x,y,z are the voxel indices.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atlas_file : Union[str,nib.nifti1.Nifti1Image]</span>
<span class="sd">            pathway to nifti file or the nib.load nifti file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ROIs_coord : dict</span>
<span class="sd">            dictionary where for the key is label, and value is the x,y,z coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">brain_map</span> <span class="o">=</span> <span class="n">Brainmap</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">)</span>
        <span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># if nan exist set to 0</span>
        <span class="n">ROIs_coord</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ROIs_coord</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">brain_map</span><span class="o">.</span><span class="n">atlas</span> <span class="o">==</span> <span class="n">label</span><span class="p">)]</span>
        <span class="n">ROIs_coord</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ROIs_coord</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ROIs_coord</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ROIs_coord</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Label&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ROIs_coord</span></div></div>

        
<div class="viewcode-block" id="Geneset"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Geneset">[docs]</a><span class="k">class</span> <span class="nc">Geneset</span><span class="p">:</span>

<div class="viewcode-block" id="Geneset.create_heatmap"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Geneset.create_heatmap">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_heatmap</span><span class="p">(</span><span class="n">gene_set_table</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                       <span class="n">genes_set_column</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GeneSet&#39;</span><span class="p">,</span>
                       <span class="n">genes_list_column</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;genes&#39;</span><span class="p">,</span>
                       <span class="n">gene_table</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">top</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
                       <span class="n">ordered_by</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;P_Frontal_lobe_WM&#39;</span><span class="p">,</span>
                       <span class="n">gene_table_gene_name</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;Genes_Name&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a heatmap of gene set analysis, where the x-axis is the list of genes, and y-axis is the gene set list.</span>
<span class="sd">        Args:</span>
<span class="sd">            gene_set_table (pd.DataFrame): enrichment result in table format</span>
<span class="sd">            |Geneset|P-value for phenotype 1| P-value for phenotype 2|List of genes| etc.</span>
<span class="sd">            genes_set_column (str, optional): _description_. Defaults to &#39;GeneSet&#39;.</span>
<span class="sd">            genes_list_column (str, optional): _description_. Defaults to &#39;genes&#39;.</span>
<span class="sd">            gene_table (pd.DataFrame, optional): table containing rows of genes (or SNPs) and columns of P-value associated with 1 or 2 phenotypes (usually 1 for variable of interest and 1 taken directly from GWAS schizophrenia). Defaults to None.</span>
<span class="sd">        Note:</span>
<span class="sd">        The following genes name in the FUMA Gene-sets do not correspond with genes name in gene-table</span>
<span class="sd">        [&#39;ADGRV1&#39; if gene == &#39;GPR98&#39; else &#39;ADGRB3&#39; if gene == &#39;BAI3&#39; else gene for gene in FUMA_gene_sets]</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            heatmap: binary np.array, the x axis = list of genes, y axis = gene sets, 1 where there is a presence of the gene in gene set.</span>
<span class="sd">            all_genes = genes names on the x-axis</span>
<span class="sd">            gene_sets = genes set names on the y-axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">heatmap_array</span><span class="p">(</span><span class="n">genesets</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                          <span class="n">genelist</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                          <span class="n">geneset_dict</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Attributes:</span>
<span class="sd">                genesets = list of gene sets</span>
<span class="sd">                genelist = list of genes</span>
<span class="sd">                geneset_dict = dictionary where keys are genesets, and values are gene lists</span>
<span class="sd">            Return</span>
<span class="sd">                heatmap: binary np.array, the x axis = list of genes, y axis = gene sets, 1 where there is a presence of the gene in gene set.</span>
<span class="sd">                all_genes = genes names on the x-axis</span>
<span class="sd">                gene_sets = genes set names on the y-axis</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">heatmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">genesets</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">genelist</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">gene_set</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">genesets</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">genelist</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">geneset_dict</span><span class="p">[</span><span class="n">gene_set</span><span class="p">]:</span>
                        <span class="n">heatmap</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># new_idx = [idx for idx,gene in enumerate(genelist) if gene in list(geneset_dict.values())[0]]</span>
            <span class="c1"># old_idx = [idx for idx in range(len(genelist)) if idx not in new_idx]</span>
            <span class="c1"># new_idx = new_idx + old_idx</span>
            <span class="c1"># heatmap = heatmap[:,new_idx]</span>
            <span class="c1"># genelist = [genelist[idx] for idx in new_idx]</span>
            <span class="k">return</span> <span class="n">heatmap</span><span class="p">,</span> <span class="n">genelist</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">geneset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="n">gene_set_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gene_set_table</span><span class="p">[</span><span class="n">genes_set_column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">gene_set_table</span><span class="p">[</span><span class="n">genes_list_column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>
        <span class="n">all_genes</span> <span class="o">=</span> <span class="p">[</span><span class="n">gene</span> <span class="k">for</span> <span class="n">gene_set</span> <span class="ow">in</span> <span class="n">gene_set_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">gene_set</span><span class="p">]</span> <span class="c1">#all of the genes found in the enrichment result table</span>
        <span class="n">all_genes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_genes</span><span class="p">))</span> <span class="c1"># get the unique values</span>
        <span class="n">all_genes_sets</span> <span class="o">=</span> <span class="n">gene_set_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">top</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ordered_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">gene_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must provide gene table&#39;</span><span class="p">)</span>
                <span class="n">gene_table</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ADGRV1&#39;</span><span class="p">,</span><span class="s1">&#39;GPR98&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">gene_table</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ADGRB3&#39;</span><span class="p">,</span><span class="s1">&#39;BAI3&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        
                <span class="n">gene_table_considered</span> <span class="o">=</span> <span class="n">gene_table</span><span class="p">[</span><span class="n">gene_table</span><span class="p">[</span><span class="n">gene_table_gene_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">all_genes</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">ordered_by</span><span class="p">)</span>
                
                <span class="n">gene_table_considered</span> <span class="o">=</span> <span class="n">gene_table_considered</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">gene_table_gene_name</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="c1"># if there is a duplicate in the gene name keep the first (lowest p-value).</span>
            
                <span class="n">gene_list_considered</span> <span class="o">=</span> <span class="n">gene_table_considered</span><span class="p">[</span><span class="n">gene_table_gene_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[:</span><span class="n">top</span><span class="p">]</span> <span class="c1"># the gene_list_to_considered</span>
                
                <span class="k">return</span> <span class="n">heatmap_array</span><span class="p">(</span><span class="n">all_genes_sets</span><span class="p">,</span>
                                     <span class="n">gene_list_considered</span><span class="p">,</span>
                                     <span class="n">gene_set_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heatmap</span><span class="p">,</span><span class="n">gene_list_considered</span><span class="p">,</span> <span class="n">gene_sets</span> <span class="o">=</span> <span class="n">heatmap_array</span><span class="p">(</span><span class="n">all_genes_sets</span><span class="p">,</span>
                                        <span class="n">all_genes</span><span class="p">,</span>
                                        <span class="n">gene_set_dict</span><span class="p">)</span>
                <span class="n">heatmap</span> <span class="o">=</span> <span class="n">heatmap</span><span class="p">[:,:</span><span class="n">top</span><span class="p">]</span>
                <span class="n">gene_list_considered</span> <span class="o">=</span> <span class="n">gene_list_considered</span><span class="p">[:</span><span class="n">top</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">heatmap</span><span class="p">,</span> <span class="n">gene_list_considered</span><span class="p">,</span> <span class="n">gene_sets</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">heatmap_array</span><span class="p">(</span><span class="n">all_genes_sets</span><span class="p">,</span>
                                 <span class="n">all_genes</span><span class="p">,</span>
                                 <span class="n">gene_set_dict</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Geneset.visualise_enrichment_p_value"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Geneset.visualise_enrichment_p_value">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">visualise_enrichment_p_value</span><span class="p">(</span><span class="n">gene_set_table</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                     <span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;adjP&#39;</span><span class="p">,</span>
                                     <span class="n">y</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GeneSet&#39;</span><span class="p">,</span>
                                     <span class="n">colour_by</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Proportion&#39;</span><span class="p">,</span>
                                     <span class="n">xlabel</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">ylabel</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">ax</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">cbar_ax</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">gene_set_table</span><span class="p">[</span><span class="n">colour_by</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                             <span class="n">gene_set_table</span><span class="p">[</span><span class="n">colour_by</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span><span class="n">norm</span> <span class="o">=</span> <span class="n">norm</span><span class="p">)</span>
        <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
        
        <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">gene_set_table</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">colour_by</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">gene_set_table</span><span class="p">,</span><span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> 
                        <span class="n">dodge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend_</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colour_by</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>        
        <span class="k">return</span> <span class="n">ax</span></div>
<div class="viewcode-block" id="Geneset.visualise_heatmap"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Geneset.visualise_heatmap">[docs]</a>    <span class="nd">@staticmethod</span>    
    <span class="k">def</span> <span class="nf">visualise_heatmap</span><span class="p">(</span><span class="n">heatmap</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
                          <span class="n">all_genes</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                          <span class="n">gene_sets</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                          <span class="n">ax</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span><span class="o">**</span><span class="n">figkwargs</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Visualise the gene-set heatmap</span>

<span class="sd">        Args:</span>
<span class="sd">            heatmap (np.array): the heatmap generated by GeneSet.create_heatmap</span>
<span class="sd">            all_genes (List[str]): the list of genes generated by GeneSet.create_heatmap</span>
<span class="sd">            ax (np.array): the plt.Ax to plot on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">heatmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">all_genes</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">gene_sets</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_genes</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gene_sets</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">all_genes</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">gene_sets</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>
<div class="viewcode-block" id="Geneset.visualise_gene_p_value"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.Geneset.visualise_gene_p_value">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">visualise_gene_p_value</span><span class="p">(</span><span class="n">gene_table</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                               <span class="n">all_genes</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                               <span class="n">gene_table_gene_name</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;Genes_Name&#39;</span><span class="p">,</span>
                               <span class="n">ordered_by</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;P_Frontal_lobe_WM&#39;</span><span class="p">,</span>
                               <span class="n">coloured_by</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;P_schizo&#39;</span><span class="p">,</span>
                               <span class="n">bar_number</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;N_SNP&#39;</span><span class="p">,</span>
                               <span class="n">p_threshold</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">5e-08</span><span class="p">,</span>
                               <span class="n">ax</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">cbar_ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Visualise the p-value of the genes in genes list.</span>

<span class="sd">        Args:</span>
<span class="sd">            gene_table (pd.DataFrame): _description_</span>
<span class="sd">            all_genes (List[str]): _description_</span>
<span class="sd">            ordered_by (str,optional): the p-value column name to order by</span>
<span class="sd">            coloured_by (str, optional): the p-value column name to colour the bar. Defaults to P_schizo.</span>
<span class="sd">            bar_number (str, optional): the column name of number of SNPs in the gene. Defaults to N_SNPs.</span>
<span class="sd">            p_threshold (float, optional): _description_. Defaults to None.</span>
<span class="sd">            ax: the plt.Axes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gene_table</span> <span class="o">=</span> <span class="n">gene_table</span><span class="p">[</span><span class="n">gene_table</span><span class="p">[</span><span class="n">gene_table_gene_name</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">all_genes</span><span class="p">)]</span>
        <span class="n">gene_table</span> <span class="o">=</span> <span class="n">gene_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">ordered_by</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">gene_table_gene_name</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span><span class="c1"># order and drop the duplicates</span>
        <span class="n">gene_table</span><span class="p">[</span><span class="n">gene_table_gene_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">gene_table</span><span class="p">[</span><span class="n">gene_table_gene_name</span><span class="p">],</span>
                                                          <span class="n">categories</span><span class="o">=</span><span class="n">all_genes</span><span class="p">,</span>
                                                          <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">gene_table</span> <span class="o">=</span> <span class="n">gene_table</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">gene_table_gene_name</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bar_plot_y_axis</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">gene_table</span><span class="p">[</span><span class="n">ordered_by</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        
        <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gene_table_gene_name</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">bar_plot_y_axis</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">gene_table</span><span class="p">,</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">coloured_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bar_plot_colour_by</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">gene_table</span><span class="p">[</span><span class="n">coloured_by</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">p_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bar_clrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grey&#39;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">p_threshold</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bar_plot_colour_by</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">patch</span><span class="p">,</span><span class="n">bar_clr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span><span class="n">bar_clrs</span><span class="p">):</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">bar_clr</span><span class="p">)</span>
                    
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">bar_plot_colour_by</span><span class="p">))</span>
                <span class="n">rank</span> <span class="o">=</span> <span class="n">bar_plot_colour_by</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">gene_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                <span class="n">my_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">pal</span><span class="p">)</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bar_plot_colour_by</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">my_cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
                <span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
                <span class="n">palette</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pal</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">patch</span><span class="p">,</span><span class="n">bar_clr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span><span class="n">palette</span><span class="p">[</span><span class="n">rank</span><span class="p">[</span><span class="n">index</span><span class="p">]]):</span>
                    <span class="n">patch</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">bar_clr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cbar_ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cbar</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span><span class="n">cax</span> <span class="o">=</span> <span class="n">cbar_ax</span><span class="p">)</span>
                    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$-log_</span><span class="si">{10}</span><span class="s1">(SNP p-value) SCZ $&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bar_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>                   
            <span class="k">for</span> <span class="n">patch</span><span class="p">,</span><span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span><span class="n">gene_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">bar_number</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">label</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">*</span><span class="mf">1.005</span><span class="p">,</span>
                                <span class="n">patch</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="o">*</span><span class="mf">1.005</span><span class="p">),</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> 
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$-log_</span><span class="si">{10}</span><span class="s1">(SNP p-value) FL_</span><span class="si">{WM}</span><span class="s1">.R$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div></div>
        
        
        
        
    
<div class="viewcode-block" id="visualise_heatmap"><a class="viewcode-back" href="../../nimagen.html#nimagen.visualisation.visualise_heatmap">[docs]</a><span class="k">def</span> <span class="nf">visualise_heatmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                      <span class="n">ax</span><span class="p">,</span>
                      <span class="n">xlabel</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">ylabel</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    
    <span class="n">heatmap</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">heatmap</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">heatmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">heatmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">heatmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">heatmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">g</span></div>
    
    
    
        
    
    

    








        
        
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">NIMAGEN</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Hai Le.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>